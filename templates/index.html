<!-- /home/pi/autocarz/templates/index.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>라즈베리파이 YOLO + OpenCV 실시간 스트리밍</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <h1>🔍 라즈베리파이 YOLO + OpenCV 이중 검출</h1>
        
        <!-- 시스템 상태 정보 -->
        <div class="status info">
            <p><strong>YOLO 상태:</strong> {{ yolo_status }}</p>
            <p><strong>OpenCV 상태:</strong> {{ opencv_status }}</p>
            <p><strong>카메라:</strong> Pi Camera v2 ({{ detection_settings.resolution }})</p>
            <p><strong>성능 비교:</strong> 실시간 이중 검출 + 딜레이 측정</p>
        </div>
        
        <!-- 색상 구분 범례 -->
        <div class="legend">
            <h3>🎨 검출 결과 색상 구분</h3>
            <div class="legend-item">
                <span class="color-box blue-box"></span>
                <strong>파란색 박스:</strong> YOLO v8 검출 결과
            </div>
            <div class="legend-item">
                <span class="color-box red-box"></span>
                <strong>빨간색 박스:</strong> OpenCV Haar Cascade 검출 결과
            </div>
        </div>
        
        <!-- 검출 설정 -->
        <div class="controls">
            <h3>🎛️ 검출 설정</h3>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="yolo_enabled" {{ 'checked' if detection_settings.yolo_enabled else '' }}>
                    YOLO 검출 활성화 (파란색)
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="opencv_enabled" {{ 'checked' if detection_settings.opencv_enabled else '' }}>
                    OpenCV 검출 활성화 (빨간색)
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="show_fps" {{ 'checked' if detection_settings.show_fps else '' }}>
                    FPS 및 검출 정보 표시
                </label>
            </div>
            
            <div class="control-group">
                <label for="quality">JPEG 품질:</label>
                <input type="range" id="quality" min="50" max="100" value="{{ detection_settings.quality }}" class="slider">
                <span id="quality_value">{{ detection_settings.quality }}</span>
            </div>
            
            <div class="control-group">
                <label for="fps_limit">FPS 제한:</label>
                <input type="range" id="fps_limit" min="5" max="30" value="{{ detection_settings.fps_limit }}" class="slider">
                <span id="fps_value">{{ detection_settings.fps_limit }}</span>
            </div>
            
            <button class="btn-primary" onclick="applyDetectionSettings()">검출 설정 적용</button>
        </div>
        
        <!-- 카메라 설정 -->
        <div class="controls">
            <h3>📹 카메라 설정</h3>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="horizontal" {{ 'checked' if flip_settings.horizontal else '' }}>
                    좌우 반전
                </label>
            </div>
            
            <div class="control-group">
                <label>
                    <input type="checkbox" id="vertical" {{ 'checked' if flip_settings.vertical else '' }}>
                    상하 반전
                </label>
            </div>
            
            <div class="control-group">
                <label>회전:</label>
                <select id="rotation">
                    <option value="0" {{ 'selected' if flip_settings.rotation == 0 else '' }}>0°</option>
                    <option value="90" {{ 'selected' if flip_settings.rotation == 90 else '' }}>90°</option>
                    <option value="180" {{ 'selected' if flip_settings.rotation == 180 else '' }}>180°</option>
                    <option value="270" {{ 'selected' if flip_settings.rotation == 270 else '' }}>270°</option>
                </select>
            </div>
            
            <button class="btn-primary" onclick="applySettings()">카메라 설정 적용</button>
            <button class="btn-warning" onclick="resetSettings()">전체 초기화</button>
        </div>
        
        <!-- 메시지 표시 영역 -->
        <div id="message" class="status" style="display: none;"></div>
        
        <!-- 라이브 스트리밍 영역 -->
        <div class="video-container">
            <h3>📺 실시간 이중 검출 스트리밍</h3>
            <img src="/video_feed" alt="라이브 스트리밍" class="video-stream">
            <div class="video-info">
                <p>💡 팁: YOLO(파란색)는 정확하지만 느리고, OpenCV(빨간색)는 빠르지만 단순합니다.</p>
            </div>
        </div>
        
        <!-- 빠른 설정 -->
        <div class="controls">
            <h3>🎮 빠른 설정</h3>
            <button class="btn-primary" onclick="setFlip('normal')">정상</button>
            <button class="btn-primary" onclick="setFlip('horizontal')">좌우 반전</button>
            <button class="btn-primary" onclick="setFlip('vertical')">상하 반전</button>
            <button class="btn-primary" onclick="setFlip('both')">상하좌우 반전</button>
            <button class="btn-primary" onclick="setFlip('rotate180')">180° 회전</button>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>